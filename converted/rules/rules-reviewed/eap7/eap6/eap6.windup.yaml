metadata:
- description: "\n            This ruleset provides analysis of JBoss EAP 6 xml files
    that may require\n            individual attention when migrating to JBoss EAP
    7+.\n        "
  dependencies:
    addon:
    - id: org.jboss.windup.rules,windup-rules-javaee,2.3.0.Final
    - id: org.jboss.windup.rules,windup-rules-java,2.3.0.Final
  sourceTechnology:
  - id: eap
    versionRange: '[6,7)'
  targetTechnology:
  - id: eap
    versionRange: '[7,)'
rules:
  rule:
  - when:
      filecontent:
      - pattern: remote://{node}:{port}
        filename: '{*}.{extension}'
    perform:
      hint:
      - message: "\n                        Default Remote JNDI Provider URL has changed
          in EAP 7. External applications using JNDI to lookup remote resources, for
          instance an EJB or a JMS Queue,\n                        may need to change
          the value for the JNDI InitialContext environment's property named `java.naming.provider.url`.\n
          \                       The default URL scheme is now **http-remoting**
          instead of **remote**, and the default URL port is now **8080** instead
          of **4447**.\n\n                        As an example, consider the application
          server host is localhost, then clients previously accessing EAP 6 would
          use\n\n                        ```\n                        java.naming.factory.initial=org.jboss.naming.remote.client.InitialContextFactory\n
          \                       java.naming.provider.url=remote://localhost:4447\n
          \                       ```\n\n                        while clients now
          accessing EAP 7 should use instead\n\n                        ```\n                        java.naming.factory.initial=org.jboss.naming.remote.client.InitialContextFactory\n
          \                       java.naming.provider.url=http-remoting://localhost:8080\n
          \                       ```\n\n                    "
        link:
        - value: ""
          title: Remote JNDI URL in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_default_remote_url_connector_and_port_changes
        tag:
        - jndi
        - configuration
        - ejb
        title: Remote JNDI Provider URL has changed in EAP 7
        category-id: mandatory
        effort: 1
    where:
    - matches:
      - pattern: .*
      param: node
    - matches:
      - pattern: \d*
      param: port
    - matches:
      - pattern: (java|properties|xml)
      param: extension
  - when:
      filecontent:
      - pattern: remote.connection.{*}.port{portnumber}
        filename: jboss-ejb-client.properties
    perform:
      hint:
      - message: "\n                        The default remote connection port has
          changed in **jboss-ejb-client.properties** from '4447' to '8080'.\n\n                        In
          EAP 6, the jboss-ejb-client.properties file looked similar to the following:\n\n
          \                       ```\n                        remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false\n
          \                       remote.connections=default\n                        remote.connection.default.host=localhost\n
          \                       remote.connection.default.port=4447\n                        remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false\n
          \                       ```\n\n                        In EAP 7, the properties
          file looks like this:\n\n                        ```\n                        remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false\n
          \                       remote.connections=default\n                        remote.connection.default.host=localhost\n
          \                       remote.connection.default.port=8080\n                        remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false\n
          \                       ```\n\n                    "
        link:
        - value: ""
          title: Remote JNDI URL in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#update_the_default_remote_connection_port
        tag:
        - jndi
        - configuration
        - ejb
        title: jboss-ejb-client.properties - Default Remote Connection Port changes
        category-id: mandatory
        effort: 1
    where:
    - matches:
      - pattern: (.*(?!8080)\d{4})
      param: portnumber
  - when:
      filecontent:
      - pattern: remote.connection.{*}.port{portnumber}
        filename: '{*}.java'
    perform:
      hint:
      - message: "\n                        The default remote connection port has
          changed from '4447' to '8080'.\n\n                        In EAP 6, Remote
          EJB client Java code looks like the following:\n\n                        ```java\n
          \                       Properties properties = new Properties();\n                        properties.put(\"remote.connection.default.port\",
          \"4447\");\n                        ```\n\n                        In EAP
          7, the Java client code looks like this:\n\n                        ```java\n
          \                       Properties properties = new Properties();\n                        properties.put(\"remote.connection.default.port\",
          \"8080\");\n                        ```\n\n                    "
        link:
        - value: ""
          title: Remote JNDI URL in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#update_the_default_remote_connection_port
        tag:
        - jndi
        - configuration
        - ejb
        title: Java - Default Remote Connection Port has changed in EAP 7
        category-id: mandatory
        effort: 1
    where:
    - matches:
      - pattern: (.*(?!8080)\d{4})
      param: portnumber
  - when:
      or:
      - filecontent:
        - pattern: com.sun.faces.facelets.FACELET_CONTEXT
          filename: '{*}.java'
        - pattern: FaceletContext.FACELET_CONTEXT_KEY
          filename: '{*}.java'
    perform:
      hint:
      - message: "\n                        The value of JSF constant `FaceletContext.FACELET_CONTEXT_KEY`
          has changed between JSF 2.1 and 2.2.\n                        The variable
          is a compile-time constant expression, so when the program was originally
          compiled,\n                        the reference to `FACELET_CONTEXT_KEY`
          was replaced by its value during compilation.\n                        The
          application must be recompiled so that the reference to `FACELET_CONTEXT_KEY`
          is replaced by its new value.\n                    "
        link:
        - value: ""
          title: Compatibility Issue Between JSF 2.1 and JSF 2.2
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#compatibility_issue_between_jsf_2_1_and_jsf_2_2
        tag:
        - jsf
        title: JSF FaceletContext.FACELET_CONTEXT_KEY changed value
        category-id: mandatory
        effort: 1
  - when:
      filecontent:
      - pattern: org.jboss.security.ignoreHttpsHost
        filename: '{*}.{extension}'
    perform:
      hint:
      - message: "In EAP 6, you could disable the HTTPS URL hostname check against
          a service’s Common Name (CN) given in its certificate by setting the system
          property `org.jboss.security.ignoreHttpsHost` to `true`. This system property
          name has been replaced with `cxf.tls-client.disableCNCheck` in EAP 7. \n
          \                   "
        link:
        - value: ""
          title: IgnoreHttpsHost CN Check Change
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#changes_to_set_cookie_behavior
        tag:
        - certificate
        - https
        quickfix:
        - replacement: cxf.tls-client.disableCNCheck
          search: org.jboss.security.ignoreHttpsHost
          type: REPLACE
          name: ignoreHttpsCheck
        title: HTTPS URL hostname check against a service’s Common Name (CN) changed
        category-id: mandatory
        effort: 1
    where:
    - matches:
      - pattern: (java|properties|xml|cmd|sh|bat)
      param: extension
sourceFile: http://github.com/windup/windup-rulesets/tree/master/rules/rules-reviewed/eap7/eap6/eap6.windup.xml
